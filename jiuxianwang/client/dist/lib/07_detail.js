"use strict";$(function(){for(var t,s,n,e=(t="user_id",s=document.cookie,n={},s.split("; ").forEach(function(t){var s=t.split("="),i=s[0],e=s[1];n[i]=e}),n[t]),i=decodeURI(location.search),a=(i=i.slice(1)).split("&"),o={},r=0,c=a.length;r<c;r++){var l=a[r].split("=");o[l[0]]=l[1]}var d="<img src='"+o.img+"' alt=''>",f="<img src='"+o.img+'\' alt=\'\'>\n    <div class="mask"></div>\n    <div class="opacity-top"></div>';$(".dIntro .show-pic").append(f),$(".dIntro .max-img").append(d),$(".dIntro .show-list .show-list-con ul li a").eq(0).html(d),$(".dIntro .introInfo .comName h1").text(""+o.title.slice(0,30)),$(".dIntro .introInfo .comName").attr("data-goods-id",o.goods_id),$(".dIntro .introInfo .priceBox .infoPri strong").text(""+o.price),$(".dIntro .introInfo .salesScoreGold .comSales em").text(""+o.judge);var u=document.querySelector(".dIntro .show-pic"),h=document.querySelector(".dIntro .show-pic img"),m=document.querySelector(".dIntro .show-pic .mask"),p=document.querySelector(".dIntro .introShow .max-img"),g=document.querySelector(".dIntro .introShow .max-img img");function v(){$.ajax({type:"get",url:"../../../server/cart.php",data:"type=get&user_id="+e,dataType:"json",success:function(t){var s;s=t.map(function(t){return'<div class="rsCartItem clearfix">\n            <div class="cartItemInfo info01">\n            <div class="rsCartCom-pic">\n            <a href="./07_detail.html?img='+t.src+"&title="+t.proName+"&price="+t.price+"&judge="+t.judge+"&goods_id="+t.id+'" target="_blank">\n            <img alt='+t.proName.slice(0,10)+" src="+t.src+" data-goods-id="+t.id+'></a></div>\n            <div class="rsCartCom-name">\n                <p><a href=./07_detail.html?img='+t.src+"&title="+t.proName+"&price="+t.price+"&judge="+t.judge+"&goods_id="+t.id+' target="_blank"\n                title='+t.proName+">"+t.proName+'</a></p>\n            </div>\n            </div>\n            <div class="cartItemInfo info02">\n                <div class="comAmount">\n                    <a href="javascript:;" class="calc dec">-</a>\n                    <span id="xgnum">'+t.num+'</span>\n                    <a href="javascript:;" class="calc plus">+</a>\n                </div>\n            </div>\n            <div class="cartItemInfo info03">￥'+t.price+'</div>\n            <div class="del">×\n            </div>\n        </div>'}).join(""),$("#rsCartTable").html(s),y()}})}function b(){$.ajax({type:"get",url:"../../../server/cart.php",data:"type=getCount&user_id="+e,dataType:"json",success:function(t){"success"==t.status&&($(".rsCartTotal .amountAll b").text(t.count),$(".jx_car_num").text(t.count))}})}function x(s,i){var t=$(s).parents(".rsCartItem").children(".info01").find("img").data("goods-id");$.ajax({type:"get",url:"../../../server/cart.php",data:"type=update&user_id="+e+"&goods_id="+t+"&count="+i,dataType:"json",success:function(t){$(s).siblings("#xgnum").text(i),b(),y()}})}function y(){var i=0;$(".rsCartTable").find(".rsCartItem").each(function(){var t=1*$(this).children(".info02").find("#xgnum").text(),s=1*$(this).find(".info03").text().slice(1);i+=t*s}),$("#priAll span").text(i)}u.onmouseenter=function(){m.style.display="block",p.style.display="block"},u.onmouseleave=function(){m.style.display="none",p.style.display="none"},u.onmousemove=function(t){var s=t.offsetY-m.offsetHeight/2,i=t.offsetX-m.offsetWidth/2;i<0&&(i=0),s<0&&(s=0);var e=u.offsetWidth-m.offsetWidth,n=u.offsetHeight-m.offsetHeight;e<i&&(i=e),n<s&&(s=n),m.style.top=s+"px",m.style.left=i+"px";var a=(g.offsetWidth-p.offsetWidth)/e,o=(g.offsetHeight-p.offsetHeight)/e;g.style.left=-i*a+"px",g.style.top=-s*o+"px"},$(".dIntro .introShow .show-list .show-list-con ul").find("li").each(function(t,s){$(s).mouseenter(function(){$(this).addClass("on").siblings().removeClass("on"),g.src=$(this).find("img").get(0).src,h.src=$(this).find("img").get(0).src})}),$(".buyNum input").change(function(){99<=$(this).val()?$(this).val("99"):$(this).val()<=1&&$(this).val("1")}),$(".buyNum-add").on("click",function(){var t=1*$(this).siblings("input").val();99<=(t+=1)&&(t=99),$(this).siblings("input").val(t)}),$(".buyNum-reduce").on("click",function(){var t=1*$(this).siblings("input").val();(t-=1)<=1&&(t=1),$(this).siblings("input").val(t)}),$(".buyBtn-cart").on("click",function(){if(user_name&&e){var t=$(this).parents(".introInfo").children(".comName").data("goods-id"),s=$(this).parents(".bayBtnBox").prev().find("input").val();$.ajax({type:"get",url:"../../../server/cart.php",data:"type=add&goods_id="+t+"&user_id="+e+"&num="+s,dataType:"json",success:function(t){"success"==t.status&&(alert("已加入购物车！"),b(),v())}})}else alert("请先登录！"),window.location.href="./05_login.html"}),b(),v(),$(".rSidebarItem").mouseenter(function(){$(this).children("a").addClass("on"),$(this).siblings().children(".rSidebarItem a").removeClass("on")}),$(".rSidebarItem").mouseleave(function(){$(this).children("a").removeClass("on")}),$(".rSidebarItem.cart").click(function(){$(".rsCartBox").toggle(500),$(this).children("a").hasClass("onn")?$(this).children("a").removeClass("onn"):$(this).children("a").addClass("onn").removeClass("on")}),$(".rsCartClose").click(function(){$(".rsCartBox").hide(500)}),$(document).click(function(t){var s=$(".rightSidebarBox").get(0);target=t.target||t.srcElement,1!=$(".rightSidebarBox").find($(target)).length&&s!=target&&$(".rsCartBox").hide(500).siblings(".cart").children("a").removeClass("onn")}),$(".rsCartTable").on("mouseenter",".rsCartItem",function(){$(this).addClass("bgc").siblings().removeClass("bgc"),$(this).children().find(".calc").css({color:"#666666",border:"1px solid #cccccc"}),$(this).siblings().children().find(".calc").css({color:"#ffffff",border:"1px solid #ffffff"}),$(this).children(".del").css("display","block"),$(this).siblings().children(".del").css("display","none")}),$(".rsCartTable").on("mouseleave",".rsCartItem",function(){$(this).removeClass("bgc"),$(this).children().find(".calc").css({color:"#ffffff",border:"1px solid #ffffff"}),$(this).children(".del").css("display","none")}),$(".rsCartTable").on("click",".plus",function(){var t=1*$(this).siblings("#xgnum").text();99<=(t+=1)&&(t=99),$(this).siblings("#xgnum").text(t),x(this,t)}),$(".rsCartTable").on("click",".dec",function(){var t=1*$(this).siblings("#xgnum").text();(t-=1)<=1&&(t=1),$(this).siblings("#xgnum").text(t-1),x(this,t)}),$(".rsCartTable").on("click",".del",function(){var t=$(this).parents(".rsCartItem").children(".info01").find("img").data("goods-id");$.ajax({type:"get",url:"../../../server/cart.php",data:"type=delete&user_id="+e+"&goods_id="+t,dataType:"json",success:function(t){"success"==t.status&&(v(),b(),y())}})})});